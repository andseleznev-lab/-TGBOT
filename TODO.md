# TODO - Telegram Mini App для записи на консультации

## Текущий прогресс

### Выполнено (31.01.2026)

- [x] **Этап 0**: Подготовка и ориентирование
- [x] **Этап 1.1**: Изучение файловой структуры
- [x] **Этап 1.2**: Анализ ошибок в логах и коде
- [x] **Этап 1.3**: Создание отчёта `analysis-report.md`

### Исправленные критические ошибки

| # | Проблема | Файл | Статус |
|---|----------|------|--------|
| 1 | Отсутствовал файл `api.js` | `api.js` | Создан |
| 2 | CONFIG не экспортировался для ES modules | `config.js` | Исправлено |
| 3 | Скрипты не загружались как ES modules | `index.html` | Исправлено |
| 4 | Несоответствие `data-tab="mybookings"` vs `my-bookings` | `index.html` | Исправлено |
| 5 | Неверные CSS-селекторы `.tab` вместо `.tab-btn` | `app.js` | Исправлено |
| 6 | Отсутствовал HTML-контент вкладок | `index.html` | Добавлен |
| 7 | Отсутствовали стили `.tab-content` | `styles.css` | Добавлены |
| 8 | Накопление обработчиков MainButton | `app.js` | Исправлено |

---

## Следующие шаги

### Высокий приоритет

- [ ] **Деплой на GitHub Pages**
  ```bash
  git add api.js config.js app.js index.html styles.css analysis-report.md TODO.md
  git commit -m "Fix: критические ошибки Mini App - api.js, ES modules, вкладки"
  git push
  ```

- [ ] **Тестирование в Telegram**
  - Открыть Mini App через бота
  - Проверить переключение вкладок
  - Проверить загрузку дат на вкладке "Запись"
  - Проверить загрузку бронирований на вкладке "Записи"
  - Проверить бронирование слота

### Средний приоритет

- [ ] **Настройка реальных URL оплаты**
  - Заменить `https://your-payment-link.com/card` на реальный URL
  - Заменить `https://your-payment-link.com/kaspi` на реальный URL
  - Файл: `index.html` (строки 71, 79)

- [ ] **Валидация initData на бэкенде**
  - Добавить проверку подписи в Make.com сценарии
  - Защита от подделки запросов

- [ ] **Улучшение обработки ошибок**
  - Добавить retry логику для API запросов
  - Улучшить сообщения об ошибках для пользователя

### Низкий приоритет

- [ ] **Удаление отладочных инструментов перед релизом**
  - Удалить кнопки "Скачать логи", "Копировать", "Очистить"
  - Удалить Eruda DevTools
  - Файл: `index.html` (строки 51-55, 315-320)

- [ ] **Оптимизация производительности**
  - Увеличить TTL кэша для стабильных данных
  - Добавить предзагрузку данных

- [ ] **Улучшение UX**
  - Добавить skeleton loading для карточек
  - Добавить haptic feedback на действия

---

## Структура проекта

```
-TGBOT/
├── index.html          # Главная страница Mini App
├── app.js              # Основная логика приложения
├── api.js              # Модуль для работы с Make.com webhook
├── config.js           # Конфигурация и инициализация Telegram
├── styles.css          # Стили приложения
├── analysis-report.md  # Отчёт об анализе ошибок
├── TODO.md             # Этот файл
└── Логи*.txt           # Файлы логов для отладки
```

---

## Известные проблемы

1. **Таймауты API** - иногда запросы к Make.com занимают >15 секунд
   - Возможная причина: нагрузка на webhook или сложные сценарии
   - Решение: оптимизация сценариев в Make.com

2. **Webhook URL в коде** - публично виден в `config.js`
   - Рекомендация: перенести на серверную часть для продакшена

---

## Контакты и ресурсы

- **GitHub Pages**: https://[username].github.io/-TGBOT/
- **Make.com Webhook**: `https://hook.eu2.make.com/r61db3c6xvtw765yx3hy8629561k23ba`
- **Telegram Bot**: @[bot_username]
