<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <title>–ó–∞–ø–∏—Å—å –Ω–∞ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—é</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link rel="stylesheet" href="styles.css?v=45">
    
    <!-- üîß –°–¢–ò–õ–ò –î–õ–Ø –ö–ù–û–ü–û–ö –û–¢–õ–ê–î–ö–ò -->
    <style>
        /* –°—Ç–∏–ª–∏ –¥–ª—è –∫–Ω–æ–ø–∫–∏ —Å–∫–∞—á–∏–≤–∞–Ω–∏—è –ª–æ–≥–æ–≤ */
        #debug-controls {
            position: fixed;
            top: 10px;
            right: 10px;
            z-index: 9999;
            display: flex;
            gap: 8px;
        }

        .debug-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 10px 16px;
            border-radius: 12px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
            transition: all 0.2s;
        }

        .debug-btn:active {
            transform: scale(0.95);
        }

        .debug-btn.success {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
        }

        .debug-btn.error {
            background: linear-gradient(135deg, #eb3349 0%, #f45c43 100%);
        }
    </style>
</head>
<body>
    <!-- üîß –ö–ù–û–ü–ö–ò –û–¢–õ–ê–î–ö–ò -->
    <div id="debug-controls">
        <button class="debug-btn" onclick="downloadLogs()">üì• –°–∫–∞—á–∞—Ç—å –ª–æ–≥–∏</button>
        <button class="debug-btn" onclick="copyLogs()">üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
        <button class="debug-btn" onclick="clearLogs()">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å</button>
    </div>

    <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è -->
    <div id="app">
        <div class="loader-container">
            <div class="glass-loader"></div>
            <p>–ó–∞–≥—Ä—É–∑–∫–∞...</p>
        </div>
    </div>

    <!-- –ö–∞—Å—Ç–æ–º–Ω—ã–π –ø–æ–ø–∞–ø —É—Å–ø–µ—Ö–∞ -->
    <div id="success-popup-overlay" class="success-popup-overlay hidden">
        <div class="success-popup">
            <div class="success-popup-header">
                <h2 id="success-popup-title">–ì–æ—Ç–æ–≤–æ</h2>
            </div>
            <div class="success-popup-body">
                <p id="success-popup-message">–ó–∞–ø–∏—Å—å –æ—Ç–º–µ–Ω–µ–Ω–∞</p>
            </div>
            <div class="success-popup-footer">
                <button class="success-popup-button" onclick="hideSuccessPopup()">–û–ö</button>
            </div>
        </div>
    </div>

    <!-- –ö–∞—Å—Ç–æ–º–Ω—ã–π –ø–æ–ø–∞–ø –æ—à–∏–±–∫–∏ (—Å–ª–æ—Ç –∑–∞–Ω—è—Ç) -->
    <div id="error-popup-overlay" class="error-popup-overlay hidden">
        <div class="error-popup">
            <div class="error-popup-header">
                <h2 id="error-popup-title">–£–ø—Å!</h2>
            </div>
            <div class="error-popup-body">
                <p id="error-popup-message">–°–ª–æ—Ç —É–∂–µ –∑–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω</p>
            </div>
            <div class="error-popup-footer">
                <button class="error-popup-button" onclick="hideSlotTakenPopup()">–ü–æ–Ω—è—Ç–Ω–æ</button>
            </div>
        </div>
    </div>

    <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è (Tab Bar) -->
    <nav class="tab-bar">
        <button class="tab-btn active" data-tab="services">
            <svg class="tab-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <rect x="3" y="3" width="7" height="7"></rect>
                <rect x="14" y="3" width="7" height="7"></rect>
                <rect x="14" y="14" width="7" height="7"></rect>
                <rect x="3" y="14" width="7" height="7"></rect>
            </svg>
            <span>–£—Å–ª—É–≥–∏</span>
        </button>
        <button class="tab-btn" data-tab="club">
            <svg class="tab-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="9" cy="7" r="4"></circle>
                <path d="M2 21v-4a4 4 0 0 1 4-4h6a4 4 0 0 1 4 4v4"></path>
                <circle cx="18" cy="9" r="3"></circle>
                <path d="M23 21v-3a3 3 0 0 0-3-3h-1"></path>
            </svg>
            <span>–ö–ª—É–±</span>
        </button>
        <button class="tab-btn" data-tab="booking">
            <svg class="tab-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <rect x="3" y="4" width="18" height="18" rx="2"></rect>
                <line x1="16" y1="2" x2="16" y2="6"></line>
                <line x1="8" y1="2" x2="8" y2="6"></line>
                <line x1="3" y1="10" x2="21" y2="10"></line>
            </svg>
            <span>–ó–∞–ø–∏—Å—å</span>
        </button>
        <button class="tab-btn" data-tab="mybookings">
            <svg class="tab-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M9 11l3 3L22 4"></path>
                <path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"></path>
            </svg>
            <span>–ú–æ–∏ –∑–∞–ø–∏—Å–∏</span>
        </button>
    </nav>

    <!-- üîß –°–ò–°–¢–ï–ú–ê –õ–û–ì–ò–†–û–í–ê–ù–ò–Ø -->
    <script>
        // –ú–∞—Å—Å–∏–≤ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –≤—Å–µ—Ö –ª–æ–≥–æ–≤
        window.appLogs = [];
        
        // –§—É–Ω–∫—Ü–∏—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤—Ä–µ–º–µ–Ω–∏
        function formatTime(date) {
            const h = String(date.getHours()).padStart(2, '0');
            const m = String(date.getMinutes()).padStart(2, '0');
            const s = String(date.getSeconds()).padStart(2, '0');
            const ms = String(date.getMilliseconds()).padStart(3, '0');
            return `${h}:${m}:${s}.${ms}`;
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ª–æ–≥–∞
        function addLog(type, args) {
            const timestamp = new Date();
            const message = args.map(arg => {
                if (typeof arg === 'object') {
                    try {
                        return JSON.stringify(arg, null, 2);
                    } catch (e) {
                        return String(arg);
                    }
                }
                return String(arg);
            }).join(' ');
            
            window.appLogs.push({
                type: type,
                time: formatTime(timestamp),
                timestamp: timestamp.toISOString(),
                message: message
            });
            
            // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º —Ä–∞–∑–º–µ—Ä –º–∞—Å—Å–∏–≤–∞ (–ø–æ—Å–ª–µ–¥–Ω–∏–µ 1000 –ª–æ–≥–æ–≤)
            if (window.appLogs.length > 1000) {
                window.appLogs = window.appLogs.slice(-1000);
            }
        }
        
        // –ü–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ–º console.log
        const originalLog = console.log;
        console.log = function(...args) {
            addLog('LOG', args);
            originalLog.apply(console, args);
        };
        
        // –ü–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ–º console.error
        const originalError = console.error;
        console.error = function(...args) {
            addLog('ERROR', args);
            originalError.apply(console, args);
        };
        
        // –ü–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ–º console.warn
        const originalWarn = console.warn;
        console.warn = function(...args) {
            addLog('WARN', args);
            originalWarn.apply(console, args);
        };
        
        // –ü–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ–º console.info
        const originalInfo = console.info;
        console.info = function(...args) {
            addLog('INFO', args);
            originalInfo.apply(console, args);
        };
        
        // –ü–µ—Ä–µ—Ö–≤–∞—Ç –Ω–µ–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö –æ—à–∏–±–æ–∫
        window.addEventListener('error', (event) => {
            addLog('ERROR', [
                '–ù–µ–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω–∞—è –æ—à–∏–±–∫–∞:',
                event.error?.message || event.message,
                event.error?.stack || ''
            ]);
        });
        
        // üîß HOTFIX: –£–ª—É—á—à–µ–Ω–Ω—ã–π –ø–µ—Ä–µ—Ö–≤–∞—Ç –Ω–µ–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö Promise rejection
        window.addEventListener('unhandledrejection', (event) => {
            // –õ–æ–≥–∏—Ä—É–µ–º –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
            addLog('ERROR', [
                'üö® –ù–µ–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–π Promise rejection:',
                event.reason
            ]);

            console.error('üö® Unhandled Promise rejection:', event.reason);

            // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º –¥–µ—Ñ–æ–ª—Ç–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ –±—Ä–∞—É–∑–µ—Ä–∞
            event.preventDefault();

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º fallback —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é (–µ—Å–ª–∏ –æ—à–∏–±–∫–∞ –∫—Ä–∏—Ç–∏—á–Ω–∞—è)
            // –ù–û —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –Ω–µ—Ç —É–∂–µ –æ—Ç–∫—Ä—ã—Ç–æ–≥–æ popup
            if (window.State && !window.State.isPopupOpen && window.Telegram?.WebApp) {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ —ç—Ç–æ –Ω–µ AbortError (–æ—Ç–º–µ–Ω–∞ –∑–∞–ø—Ä–æ—Å–∞ - —ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ)
                const isAbortError = event.reason?.name === 'AbortError' ||
                                     event.reason?.message === 'App is inactive';

                if (!isAbortError) {
                    console.warn('‚ö†Ô∏è –ü–æ–∫–∞–∑—ã–≤–∞–µ–º fallback popup –¥–ª—è unhandled rejection');

                    try {
                        window.Telegram.WebApp.showAlert(
                            '–ü—Ä–æ–∏–∑–æ—à–ª–∞ –Ω–µ–ø—Ä–µ–¥–≤–∏–¥–µ–Ω–Ω–∞—è –æ—à–∏–±–∫–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ.'
                        );
                    } catch (e) {
                        console.error('‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–∫–∞–∑–∞—Ç—å fallback alert:', e);
                    }
                }
            }
        });
        
        // üì• –§–£–ù–ö–¶–ò–Ø –°–ö–ê–ß–ò–í–ê–ù–ò–Ø –õ–û–ì–û–í
        window.downloadLogs = function() {
            if (window.appLogs.length === 0) {
                alert('–õ–æ–≥–æ–≤ –ø–æ–∫–∞ –Ω–µ—Ç');
                return;
            }
            
            // –§–æ—Ä–º–∏—Ä—É–µ–º —Ç–µ–∫—Å—Ç –ª–æ–≥–æ–≤
            const header = `=== –õ–û–ì–ò –ü–†–ò–õ–û–ñ–ï–ù–ò–Ø ===
–î–∞—Ç–∞: ${new Date().toLocaleString('ru-RU')}
Telegram User ID: ${window.Telegram?.WebApp?.initDataUnsafe?.user?.id || 'unknown'}
User Agent: ${navigator.userAgent}
–í—Å–µ–≥–æ –ª–æ–≥–æ–≤: ${window.appLogs.length}

`;
            
            const logsText = header + window.appLogs.map(log => {
                const prefix = `[${log.time}] ${log.type.padEnd(5)}`;
                return `${prefix} | ${log.message}`;
            }).join('\n');
            
            // –°–æ–∑–¥–∞—ë–º Blob –∏ —Å–∫–∞—á–∏–≤–∞–µ–º
            const blob = new Blob([logsText], { type: 'text/plain;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `app-logs-${Date.now()}.txt`;
            
            // –î–ª—è iOS –Ω—É–∂–µ–Ω trick
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            
            URL.revokeObjectURL(url);
            
            // –í–∏–∑—É–∞–ª—å–Ω–∞—è –æ–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å
            const btn = event.target;
            const originalText = btn.textContent;
            btn.textContent = '‚úÖ –°–∫–∞—á–∞–Ω–æ!';
            btn.classList.add('success');
            
            setTimeout(() => {
                btn.textContent = originalText;
                btn.classList.remove('success');
            }, 2000);
            
            console.log('‚úÖ –õ–æ–≥–∏ —Å–∫–∞—á–∞–Ω—ã! –í—Å–µ–≥–æ –∑–∞–ø–∏—Å–µ–π:', window.appLogs.length);
        };
        
        // üìã –§–£–ù–ö–¶–ò–Ø –ö–û–ü–ò–†–û–í–ê–ù–ò–Ø –õ–û–ì–û–í
        window.copyLogs = function() {
            if (window.appLogs.length === 0) {
                alert('–õ–æ–≥–æ–≤ –ø–æ–∫–∞ –Ω–µ—Ç');
                return;
            }
            
            const header = `=== –õ–û–ì–ò –ü–†–ò–õ–û–ñ–ï–ù–ò–Ø ===
–î–∞—Ç–∞: ${new Date().toLocaleString('ru-RU')}
Telegram User ID: ${window.Telegram?.WebApp?.initDataUnsafe?.user?.id || 'unknown'}
–í—Å–µ–≥–æ –ª–æ–≥–æ–≤: ${window.appLogs.length}

`;
            
            const logsText = header + window.appLogs.map(log => {
                return `[${log.time}] ${log.type} | ${log.message}`;
            }).join('\n');
            
            // –ö–æ–ø–∏—Ä—É–µ–º –≤ –±—É—Ñ–µ—Ä
            if (navigator.clipboard && navigator.clipboard.writeText) {
                navigator.clipboard.writeText(logsText).then(() => {
                    // –í–∏–∑—É–∞–ª—å–Ω–∞—è –æ–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å
                    const btn = event.target;
                    const originalText = btn.textContent;
                    btn.textContent = '‚úÖ –°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ!';
                    btn.classList.add('success');
                    
                    setTimeout(() => {
                        btn.textContent = originalText;
                        btn.classList.remove('success');
                    }, 2000);
                    
                    console.log('‚úÖ –õ–æ–≥–∏ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω—ã –≤ –±—É—Ñ–µ—Ä! –í—Å–µ–≥–æ –∑–∞–ø–∏—Å–µ–π:', window.appLogs.length);
                }).catch(err => {
                    alert('–û—à–∏–±–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è: ' + err.message);
                });
            } else {
                // Fallback –¥–ª—è —Å—Ç–∞—Ä—ã—Ö –±—Ä–∞—É–∑–µ—Ä–æ–≤
                const textarea = document.createElement('textarea');
                textarea.value = logsText;
                textarea.style.position = 'fixed';
                textarea.style.opacity = '0';
                document.body.appendChild(textarea);
                textarea.select();
                
                try {
                    document.execCommand('copy');
                    alert('–õ–æ–≥–∏ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω—ã!');
                } catch (err) {
                    alert('–ù–µ —É–¥–∞–ª–æ—Å—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å');
                }
                
                document.body.removeChild(textarea);
            }
        };
        
        // üóëÔ∏è –§–£–ù–ö–¶–ò–Ø –û–ß–ò–°–¢–ö–ò –õ–û–ì–û–í
        window.clearLogs = function() {
            const count = window.appLogs.length;
            window.appLogs = [];
            
            const btn = event.target;
            const originalText = btn.textContent;
            btn.textContent = `‚úÖ –û—á–∏—â–µ–Ω–æ (${count})`;
            btn.classList.add('success');
            
            setTimeout(() => {
                btn.textContent = originalText;
                btn.classList.remove('success');
            }, 2000);
            
            console.log(`üóëÔ∏è –õ–æ–≥–∏ –æ—á–∏—â–µ–Ω—ã! –£–¥–∞–ª–µ–Ω–æ –∑–∞–ø–∏—Å–µ–π: ${count}`);
        };
        
        console.log('üìù –°–∏—Å—Ç–µ–º–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞');
        console.log('üíæ –î–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è –ª–æ–≥–æ–≤ –Ω–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "üì• –°–∫–∞—á–∞—Ç—å –ª–æ–≥–∏" –≤ —É–≥–ª—É');
        console.log('üìã –î–ª—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å"');
    </script>

    <!-- üîß ERUDA DevTools –¥–ª—è –º–æ–±–∏–ª—å–Ω–æ–π –æ—Ç–ª–∞–¥–∫–∏ -->
    <script src="https://cdn.jsdelivr.net/npm/eruda"></script>
    <script>
        eruda.init();
        console.log('üîß Eruda DevTools initialized');
    </script>

    <!-- –û—Å–Ω–æ–≤–Ω—ã–µ —Å–∫—Ä–∏–ø—Ç—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è -->
    <script src="config.js?v=27"></script>
    <script src="app.js?v=38">

    <!-- üìù –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∑–∞–≥—Ä—É–∑–∫–∏ -->
    <script>
        console.log('‚úÖ index.html loaded - version 38 - DEEP LINK: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ –≤–∫–ª–∞–¥–∫—É –ö–ª—É–± –∏–∑ YooKassa');
        console.log('üì¶ Files loaded:', {
            telegram: !!window.Telegram,
            config: !!window.CONFIG
        });
    </script>
</body>
</html>
