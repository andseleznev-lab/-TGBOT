<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <title>–ó–∞–ø–∏—Å—å –Ω–∞ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—é</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link rel="stylesheet" href="styles.css?v=3">
    
    <style>
        /* –°—Ç–∏–ª–∏ –¥–ª—è –∫–Ω–æ–ø–∫–∏ —Å–∫–∞—á–∏–≤–∞–Ω–∏—è –ª–æ–≥–æ–≤ */
        #debug-controls {
            position: fixed;
            top: 10px;
            right: 10px;
            z-index: 9999;
            display: flex;
            gap: 8px;
        }
        
        .debug-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 10px 16px;
            border-radius: 12px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
            transition: all 0.2s;
        }
        
        .debug-btn:active {
            transform: scale(0.95);
        }
        
        .debug-btn.success {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
        }
        
        .debug-btn.error {
            background: linear-gradient(135deg, #eb3349 0%, #f45c43 100%);
        }
    </style>
</head>
<body>
    <!-- üîß –ö–ù–û–ü–ö–ò –û–¢–õ–ê–î–ö–ò (—É–¥–∞–ª–∏—Ç–µ –ø–æ—Å–ª–µ —Ç–µ—Å—Ç–æ–≤) -->
    <div id="debug-controls">
        <button class="debug-btn" onclick="downloadLogs()">üì• –°–∫–∞—á–∞—Ç—å –ª–æ–≥–∏</button>
        <button class="debug-btn" onclick="copyLogs()">üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
        <button class="debug-btn" onclick="clearLogs()">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å</button>
    </div>

    <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è -->
    <div id="app">
        <!-- –í–∫–ª–∞–¥–∫–∞: –£—Å–ª—É–≥–∏ -->
        <div class="tab-content active" id="services-tab">
            <h1 class="screen-title">–£—Å–ª—É–≥–∏</h1>
            <div id="services-list" class="services-grid">
                <!-- –£—Å–ª—É–≥–∏ —Ä–µ–Ω–¥–µ—Ä—è—Ç—Å—è —á–µ—Ä–µ–∑ JS -->
            </div>
        </div>

        <!-- –í–∫–ª–∞–¥–∫–∞: –û–ø–ª–∞—Ç–∞ -->
        <div class="tab-content" id="payment-tab">
            <h1 class="screen-title">–û–ø–ª–∞—Ç–∞</h1>
            <div class="payment-grid">
                <div class="glass-card payment-card" onclick="window.open('https://your-payment-link.com/card', '_blank')">
                    <div class="payment-icon">üí≥</div>
                    <div class="payment-info">
                        <div class="payment-name">–ë–∞–Ω–∫–æ–≤—Å–∫–∞—è –∫–∞—Ä—Ç–∞</div>
                        <div class="payment-description">Visa, Mastercard, –ú–∏—Ä</div>
                    </div>
                    <div class="payment-arrow">‚Üí</div>
                </div>
                <div class="glass-card payment-card" onclick="window.open('https://your-payment-link.com/kaspi', '_blank')">
                    <div class="payment-icon">üì±</div>
                    <div class="payment-info">
                        <div class="payment-name">Kaspi</div>
                        <div class="payment-description">–ü–µ—Ä–µ–≤–æ–¥ –Ω–∞ Kaspi Gold</div>
                    </div>
                    <div class="payment-arrow">‚Üí</div>
                </div>
            </div>
        </div>

        <!-- –í–∫–ª–∞–¥–∫–∞: –ó–∞–ø–∏—Å—å -->
        <div class="tab-content" id="booking-tab">
            <h1 class="screen-title">–ó–∞–ø–∏—Å—å</h1>
            <div class="booking-container">
                <div id="calendar-loading" class="loader-container" style="display: none;">
                    <div class="glass-loader"></div>
                    <p>–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞—Ç...</p>
                </div>
                <div id="calendar-error" class="error" style="display: none;"></div>
                <div id="calendar" class="glass-card calendar-container"></div>
                <h2 class="section-title" id="slots-title" style="display: none;">–í—ã–±–µ—Ä–∏—Ç–µ –≤—Ä–µ–º—è</h2>
                <div id="time-slots" class="slots-grid"></div>
            </div>
        </div>

        <!-- –í–∫–ª–∞–¥–∫–∞: –ú–æ–∏ –∑–∞–ø–∏—Å–∏ -->
        <div class="tab-content" id="my-bookings-tab">
            <h1 class="screen-title">–ú–æ–∏ –∑–∞–ø–∏—Å–∏</h1>
            <div id="bookings-list">
                <!-- –ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è —Ä–µ–Ω–¥–µ—Ä—è—Ç—Å—è —á–µ—Ä–µ–∑ JS -->
            </div>
        </div>
    </div>

    <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è (Tab Bar) -->
    <nav class="tab-bar">
        <button class="tab-btn active" data-tab="services">
            <svg class="tab-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <rect x="3" y="3" width="7" height="7"></rect>
                <rect x="14" y="3" width="7" height="7"></rect>
                <rect x="14" y="14" width="7" height="7"></rect>
                <rect x="3" y="14" width="7" height="7"></rect>
            </svg>
            <span>–£—Å–ª—É–≥–∏</span>
        </button>
        <button class="tab-btn" data-tab="payment">
            <svg class="tab-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <rect x="1" y="4" width="22" height="16" rx="2"></rect>
                <line x1="1" y1="10" x2="23" y2="10"></line>
            </svg>
            <span>–û–ø–ª–∞—Ç–∞</span>
        </button>
        <button class="tab-btn" data-tab="booking">
            <svg class="tab-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <rect x="3" y="4" width="18" height="18" rx="2"></rect>
                <line x1="16" y1="2" x2="16" y2="6"></line>
                <line x1="8" y1="2" x2="8" y2="6"></line>
                <line x1="3" y1="10" x2="21" y2="10"></line>
            </svg>
            <span>–ó–∞–ø–∏—Å—å</span>
        </button>
        <button class="tab-btn" data-tab="my-bookings">
            <svg class="tab-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M9 11l3 3L22 4"></path>
                <path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"></path>
            </svg>
            <span>–ó–∞–ø–∏—Å–∏</span>
        </button>
    </nav>

    <!-- üîß –°–ò–°–¢–ï–ú–ê –õ–û–ì–ò–†–û–í–ê–ù–ò–Ø -->
    <script>
        // –ú–∞—Å—Å–∏–≤ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –≤—Å–µ—Ö –ª–æ–≥–æ–≤
        window.appLogs = [];
        
        // –§—É–Ω–∫—Ü–∏—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤—Ä–µ–º–µ–Ω–∏
        function formatTime(date) {
            const h = String(date.getHours()).padStart(2, '0');
            const m = String(date.getMinutes()).padStart(2, '0');
            const s = String(date.getSeconds()).padStart(2, '0');
            const ms = String(date.getMilliseconds()).padStart(3, '0');
            return `${h}:${m}:${s}.${ms}`;
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ª–æ–≥–∞
        function addLog(type, args) {
            const timestamp = new Date();
            const message = args.map(arg => {
                if (typeof arg === 'object') {
                    try {
                        return JSON.stringify(arg, null, 2);
                    } catch (e) {
                        return String(arg);
                    }
                }
                return String(arg);
            }).join(' ');
            
            window.appLogs.push({
                type: type,
                time: formatTime(timestamp),
                timestamp: timestamp.toISOString(),
                message: message
            });
            
            // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º —Ä–∞–∑–º–µ—Ä –º–∞—Å—Å–∏–≤–∞ (–ø–æ—Å–ª–µ–¥–Ω–∏–µ 1000 –ª–æ–≥–æ–≤)
            if (window.appLogs.length > 1000) {
                window.appLogs = window.appLogs.slice(-1000);
            }
        }
        
        // –ü–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ–º console.log
        const originalLog = console.log;
        console.log = function(...args) {
            addLog('LOG', args);
            originalLog.apply(console, args);
        };
        
        // –ü–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ–º console.error
        const originalError = console.error;
        console.error = function(...args) {
            addLog('ERROR', args);
            originalError.apply(console, args);
        };
        
        // –ü–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ–º console.warn
        const originalWarn = console.warn;
        console.warn = function(...args) {
            addLog('WARN', args);
            originalWarn.apply(console, args);
        };
        
        // –ü–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ–º console.info
        const originalInfo = console.info;
        console.info = function(...args) {
            addLog('INFO', args);
            originalInfo.apply(console, args);
        };
        
        // –ü–µ—Ä–µ—Ö–≤–∞—Ç –Ω–µ–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö –æ—à–∏–±–æ–∫
        window.addEventListener('error', (event) => {
            addLog('ERROR', [
                '–ù–µ–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω–∞—è –æ—à–∏–±–∫–∞:',
                event.error?.message || event.message,
                event.error?.stack || ''
            ]);
        });
        
        // –ü–µ—Ä–µ—Ö–≤–∞—Ç –Ω–µ–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö Promise rejection
        window.addEventListener('unhandledrejection', (event) => {
            addLog('ERROR', [
                '–ù–µ–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–π Promise rejection:',
                event.reason
            ]);
        });
        
        // üì• –§–£–ù–ö–¶–ò–Ø –°–ö–ê–ß–ò–í–ê–ù–ò–Ø –õ–û–ì–û–í
        window.downloadLogs = function() {
            if (window.appLogs.length === 0) {
                alert('–õ–æ–≥–æ–≤ –ø–æ–∫–∞ –Ω–µ—Ç');
                return;
            }
            
            // –§–æ—Ä–º–∏—Ä—É–µ–º —Ç–µ–∫—Å—Ç –ª–æ–≥–æ–≤
            const header = `=== –õ–û–ì–ò –ü–†–ò–õ–û–ñ–ï–ù–ò–Ø ===
–î–∞—Ç–∞: ${new Date().toLocaleString('ru-RU')}
Telegram User ID: ${window.Telegram?.WebApp?.initDataUnsafe?.user?.id || 'unknown'}
User Agent: ${navigator.userAgent}
–í—Å–µ–≥–æ –ª–æ–≥–æ–≤: ${window.appLogs.length}

`;
            
            const logsText = header + window.appLogs.map(log => {
                const prefix = `[${log.time}] ${log.type.padEnd(5)}`;
                return `${prefix} | ${log.message}`;
            }).join('\n');
            
            // –°–æ–∑–¥–∞—ë–º Blob –∏ —Å–∫–∞—á–∏–≤–∞–µ–º
            const blob = new Blob([logsText], { type: 'text/plain;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `app-logs-${Date.now()}.txt`;
            
            // –î–ª—è iOS –Ω—É–∂–µ–Ω trick
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            
            URL.revokeObjectURL(url);
            
            // –í–∏–∑—É–∞–ª—å–Ω–∞—è –æ–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å
            const btn = event.target;
            const originalText = btn.textContent;
            btn.textContent = '‚úÖ –°–∫–∞—á–∞–Ω–æ!';
            btn.classList.add('success');
            
            setTimeout(() => {
                btn.textContent = originalText;
                btn.classList.remove('success');
            }, 2000);
            
            console.log('‚úÖ –õ–æ–≥–∏ —Å–∫–∞—á–∞–Ω—ã! –í—Å–µ–≥–æ –∑–∞–ø–∏—Å–µ–π:', window.appLogs.length);
        };
        
        // üìã –§–£–ù–ö–¶–ò–Ø –ö–û–ü–ò–†–û–í–ê–ù–ò–Ø –õ–û–ì–û–í
        window.copyLogs = function() {
            if (window.appLogs.length === 0) {
                alert('–õ–æ–≥–æ–≤ –ø–æ–∫–∞ –Ω–µ—Ç');
                return;
            }
            
            const header = `=== –õ–û–ì–ò –ü–†–ò–õ–û–ñ–ï–ù–ò–Ø ===
–î–∞—Ç–∞: ${new Date().toLocaleString('ru-RU')}
Telegram User ID: ${window.Telegram?.WebApp?.initDataUnsafe?.user?.id || 'unknown'}
–í—Å–µ–≥–æ –ª–æ–≥–æ–≤: ${window.appLogs.length}

`;
            
            const logsText = header + window.appLogs.map(log => {
                return `[${log.time}] ${log.type} | ${log.message}`;
            }).join('\n');
            
            // –ö–æ–ø–∏—Ä—É–µ–º –≤ –±—É—Ñ–µ—Ä
            if (navigator.clipboard && navigator.clipboard.writeText) {
                navigator.clipboard.writeText(logsText).then(() => {
                    // –í–∏–∑—É–∞–ª—å–Ω–∞—è –æ–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å
                    const btn = event.target;
                    const originalText = btn.textContent;
                    btn.textContent = '‚úÖ –°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ!';
                    btn.classList.add('success');
                    
                    setTimeout(() => {
                        btn.textContent = originalText;
                        btn.classList.remove('success');
                    }, 2000);
                    
                    console.log('‚úÖ –õ–æ–≥–∏ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω—ã –≤ –±—É—Ñ–µ—Ä! –í—Å–µ–≥–æ –∑–∞–ø–∏—Å–µ–π:', window.appLogs.length);
                }).catch(err => {
                    alert('–û—à–∏–±–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è: ' + err.message);
                });
            } else {
                // Fallback –¥–ª—è —Å—Ç–∞—Ä—ã—Ö –±—Ä–∞—É–∑–µ—Ä–æ–≤
                const textarea = document.createElement('textarea');
                textarea.value = logsText;
                textarea.style.position = 'fixed';
                textarea.style.opacity = '0';
                document.body.appendChild(textarea);
                textarea.select();
                
                try {
                    document.execCommand('copy');
                    alert('–õ–æ–≥–∏ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω—ã!');
                } catch (err) {
                    alert('–ù–µ —É–¥–∞–ª–æ—Å—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å');
                }
                
                document.body.removeChild(textarea);
            }
        };
        
        // üóëÔ∏è –§–£–ù–ö–¶–ò–Ø –û–ß–ò–°–¢–ö–ò –õ–û–ì–û–í
        window.clearLogs = function() {
            const count = window.appLogs.length;
            window.appLogs = [];
            
            const btn = event.target;
            const originalText = btn.textContent;
            btn.textContent = `‚úÖ –û—á–∏—â–µ–Ω–æ (${count})`;
            btn.classList.add('success');
            
            setTimeout(() => {
                btn.textContent = originalText;
                btn.classList.remove('success');
            }, 2000);
            
            console.log(`üóëÔ∏è –õ–æ–≥–∏ –æ—á–∏—â–µ–Ω—ã! –£–¥–∞–ª–µ–Ω–æ –∑–∞–ø–∏—Å–µ–π: ${count}`);
        };
        
        console.log('üìù –°–∏—Å—Ç–µ–º–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞');
        console.log('üíæ –î–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è –ª–æ–≥–æ–≤ –Ω–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "üì• –°–∫–∞—á–∞—Ç—å –ª–æ–≥–∏" –≤ —É–≥–ª—É');
        console.log('üìã –î–ª—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å"');
    </script>

    <!-- üîß ERUDA DevTools –¥–ª—è –º–æ–±–∏–ª—å–Ω–æ–π –æ—Ç–ª–∞–¥–∫–∏ -->
    <script src="https://cdn.jsdelivr.net/npm/eruda"></script>
    <script>
        eruda.init();
        console.log('üîß Eruda DevTools initialized');
    </script>

    <!-- –û—Å–Ω–æ–≤–Ω—ã–µ —Å–∫—Ä–∏–ø—Ç—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (ES Modules) -->
    <script type="module">
        import { CONFIG, initTelegram } from './config.js';
        import { initApp } from './app.js';

        // –î–µ–ª–∞–µ–º CONFIG –≥–ª–æ–±–∞–ª—å–Ω—ã–º
        window.CONFIG = CONFIG;

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram
        const telegramData = initTelegram();

        console.log('‚úÖ index.html loaded - version 4.3 - Tab bar fixed');
        console.log('üì¶ Files loaded:', {
            telegram: !!window.Telegram,
            config: !!window.CONFIG,
            eruda: !!window.eruda
        });

        if (telegramData) {
            console.log('üöÄ Mini App initialized for user:', telegramData.USER.firstName);
            console.log('üì± Telegram Web App version:', window.Telegram.WebApp.version);
        }

        console.log('‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω—ã —Å—Ç–∞—Ç–∏—á–Ω—ã–µ —É—Å–ª—É–≥–∏:', CONFIG.SERVICES);

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        initApp();
    </script>
</body>
</html>
