# План реализации: T-007 - UI/UX улучшения

**Тикет**: T-007
**PRD**: `docs/prd/T-007.prd.md`
**Дата создания**: 2026-02-15

---

## Обзор

Добавить loading popup "Создание встречи..." при бронировании и бежевую рамку для активного таба.

---

## Архитектурные решения

### 1. Loading Popup (переиспользуем существующий паттерн)

**Текущая реализация** (для оплаты клуба):
- Функция `showPaymentLoadingPopup()` в `app.js`
- HTML popup уже существует
- CSS стили `.loading-overlay`, `.loading-card`

**Решение**:
- Создать универсальную функцию `showLoadingPopup(message)`
- Рефакторинг `showPaymentLoadingPopup()` → использовать `showLoadingPopup('Создание платежа...')`
- Для бронирования: `showLoadingPopup('Создание встречи...')`

### 2. Бежевая рамка для таба

**Текущая реализация**:
```css
.bottom-nav button.active {
  background: white;
}
```

**Решение**:
```css
.bottom-nav button.active {
  background: white;
  border: 1px solid rgba(200, 184, 160, 0.4);
  border-radius: 12px;
  box-sizing: border-box;
}
```

**Цвет**: `#C8B8A0` (beige палитра) с `opacity: 0.4`

---

## План изменений по файлам

### Файл 1: `index.html`

**Что меняем**:
- CSS стиль `.bottom-nav button.active` → добавить `border` и `border-radius`

**Код**:
```css
.bottom-nav button.active {
    background: white;
    border: 1px solid rgba(200, 184, 160, 0.4);
    border-radius: 12px;
    box-sizing: border-box;
}
```

---

### Файл 2: `app.js`

#### Изменение 1: Создать универсальную функцию `showLoadingPopup(message)`

**Новая функция**:
- Принимает параметр `message` (текст для отображения)
- Создаёт DOM элемент с классом `loading-overlay`
- Вставляет spinner + текст
- Использует `textContent` для безопасности (защита от XSS)
- Добавляет haptic feedback

**Функция `hideLoadingPopup()`**:
- Находит элемент по ID `loading-popup`
- Удаляет из DOM

---

#### Изменение 2: Добавить loading popup в `confirmBooking()`

**Логика**:
1. Вызвать `showLoadingPopup('Создание встречи...')` в начале
2. Выполнить запрос к Make.com
3. Вызвать `hideLoadingPopup()` после ответа (успех или ошибка)
4. Использовать `try/catch/finally` для надёжности

**Важно**: `hideLoadingPopup()` должен вызываться всегда (даже при ошибке)

---

## Edge Cases и обработка ошибок

### Edge Case 1: Make.com таймаут (10 секунд)

**Решение**: `hideLoadingPopup()` в блоке `catch`

### Edge Case 2: Повторное нажатие кнопки

**Решение**: Loading popup блокирует UI (`position: fixed`, `z-index: 9999`)

---

## Тестирование

### Тест 1: Loading popup при бронировании

**Шаги**:
1. Открыть вкладку "Запись"
2. Выбрать "Диагностика"
3. Выбрать дату и время
4. Нажать "Подтвердить запись"

**Ожидаемый результат**:
- Мгновенно появляется loading popup "Создание встречи..."
- Оранжевый спиннер вращается
- Через 4-5 секунд popup исчезает
- Показывается success popup "Встреча создана!"

### Тест 2: Бежевая рамка активного таба

**Шаги**:
1. Переключаться между табами

**Ожидаемый результат**:
- Активный таб: белый фон + бежевая рамка
- Неактивные табы: прозрачный фон

---

## Метрики успеха

- [ ] Loading popup появляется < 50ms
- [ ] Loading popup исчезает сразу после ответа
- [ ] Нет двойных бронирований
- [ ] Бежевая рамка видна на beige фоне
- [ ] Transition плавный

---

## Чек-лист готовности

- [x] PRD утверждён
- [x] Архитектурные решения приняты
- [x] Plan изменений готов
- [x] Edge cases продуманы
- [x] Тестовые сценарии расписаны

**Готов к реализации!** ✅
