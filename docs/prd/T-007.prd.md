# PRD: UI/UX улучшения - Loading состояние + Рамка табов

**Тикет**: T-007
**Автор**: Андрей Селезнев
**Дата создания**: 2026-02-15
**Статус**: PRD_READY

---

## Краткое описание

Добавить loading popup при создании бронирования и визуальную рамку для активного таба в нижней навигации.

---

## Проблема / Возможность

### Контекст

**Проблема 1**: При создании бронирования (нажатие "Подтвердить запись") пользователь не видит обратной связи во время запроса к Make.com (4-5 секунд). В логах видно что запрос выполняется, но UI "молчит".

**Проблема 2**: Активный таб в нижней навигации выделяется только белым фоном, что недостаточно заметно. Нужна дополнительная визуальная подсказка в виде бежевой рамки.

### Текущая ситуация (AS IS)

**Проблема 1 (Loading)**:
- Пользователь: Диагностика → Выбор даты → Выбор слота → "Подтвердить запись"
- Make.com запрос: 4-5 секунд (видно в логах: `[book_slot] Успешно за 4872ms`)
- UI: Ничего не показывается, кнопка остается активной
- Пользователь: Не понимает что происходит, может нажать повторно

**Проблема 2 (Табы)**:
- Активный таб: только белый фон (`background: white`)
- Неактивный таб: прозрачный фон
- Контраст: недостаточно заметен на бежевом фоне приложения

### Желаемая ситуация (TO BE)

**Решение 1 (Loading)**:
- Показать popup с текстом "Создание встречи..." (аналогично "Создание платежа..." из IMG_6081.PNG)
- Блокировать повторное нажатие кнопки
- Закрыть popup после успешного создания → переход на экран "Мои записи"

**Решение 2 (Табы)**:
- Активный таб: белый фон + едва заметная бежевая рамка (`border: 1px solid rgba(...)`)
- Стиль: `border-radius: 12px` (как в остальных glass-card элементах)
- Цвет рамки: из beige палитры (`#C8B8A0` или `#B8A890` с прозрачностью)

---

## Требования

### Функциональные требования

#### Must Have

- [x] **Loading Popup при создании бронирования**
  - Показывается сразу после нажатия "Подтвердить запись"
  - Текст: "Создание встречи..."
  - Оранжевый спиннер (как в "Создание платежа...")
  - Блокирует UI (размытый фон)
  - Закрывается после успешного ответа от Make.com

- [x] **Бежевая рамка для активного таба**
  - Едва заметная рамка (1px solid)
  - Цвет: beige палитра с прозрачностью
  - Применяется к активному табу в `.bottom-nav button.active`

#### Should Have

- [ ] Haptic feedback при переключении табов
- [ ] Анимация появления/скрытия loading popup (fade-in/fade-out)

### Нефункциональные требования (NFR)

**Производительность**:
- Loading popup должен появляться мгновенно (< 50ms)
- Анимация fade-in: 200ms

**Безопасность**:
- Блокировка повторного нажатия кнопки "Подтвердить запись"

**UX/UI**:
- Loading popup: соответствует дизайну "Создание платежа..." (IMG_6081.PNG)
- Рамка таба: соответствует beige палитре приложения
- Консистентность: использовать существующие CSS классы (`.glass-card`, `.spinner`)

---

## Сценарии использования

### Основной сценарий 1: Loading при бронировании (Happy Path)

**Действующие лица**: Пользователь, Система, Make.com

**Предусловия**:
- Пользователь выбрал услугу (например, "Диагностика")
- Выбрал дату (например, "18.02.2026")
- Выбрал время (например, "10:00")

**Шаги**:
1. Пользователь нажимает "Подтвердить запись"
2. Система показывает loading popup "Создание встречи..." (мгновенно)
3. Система блокирует кнопку (disable) и весь UI (dimmed background)
4. Система отправляет запрос к Make.com (`book_slot`)
5. Make.com обрабатывает запрос (4-5 секунд)
6. Make.com возвращает успешный ответ
7. Система закрывает loading popup
8. Система показывает success popup "Встреча создана!"
9. Система переключает таб на "Мои записи"

**Результат**:
- Пользователь видит обратную связь во время ожидания
- Предотвращено двойное нажатие кнопки
- Плавный переход на экран с бронированиями

### Основной сценарий 2: Визуальное выделение активного таба

**Действующие лица**: Пользователь, Система

**Предусловия**:
- Приложение открыто

**Шаги**:
1. Пользователь переключается на таб "Запись"
2. Система применяет белый фон + бежевую рамку к табу "Запись"
3. Пользователь видит четкое визуальное выделение активного таба

**Результат**:
- Пользователь всегда понимает на какой вкладке находится

### Исключительные ситуации (Edge Cases)

**Ошибка 1: Make.com таймаут**
- **Причина**: Make.com не ответил за 10 секунд
- **Обработка**: Закрыть loading popup, показать error popup
- **Сообщение пользователю**: "Не удалось создать встречу. Попробуйте позже."

**Ошибка 2: Make.com вернул ошибку**
- **Причина**: `response.success === false`
- **Обработка**: Закрыть loading popup, показать error popup
- **Сообщение пользователю**: Текст из `response.message` или дефолтное сообщение

---

## UI/UX Дизайн

### Задача 1: Loading Popup

**Дизайн** (из IMG_6081.PNG):
```html
<div class="loading-overlay">
  <div class="loading-card glass-card">
    <div class="spinner"></div>
    <div class="loading-text">Создание встречи...</div>
  </div>
</div>
```

**CSS стили**:
- `.loading-overlay`: `position: fixed`, `backdrop-filter: blur(8px)`, `z-index: 9999`
- `.loading-card`: `background: white`, `border-radius: 20px`, `padding: 40px`, центрирована
- `.spinner`: оранжевая анимация вращения (уже существует в `app.js`)
- `.loading-text`: `font-size: 16px`, `color: #8B7355`, `margin-top: 20px`

### Задача 2: Рамка активного таба

**CSS изменение** в `.bottom-nav button.active`:
```css
.bottom-nav button.active {
  background: white; /* уже есть */
  border: 1px solid rgba(200, 184, 160, 0.4); /* НОВОЕ: бежевая рамка */
  border-radius: 12px; /* НОВОЕ: скругление */
}
```

**Цвет рамки**: `#C8B8A0` (из beige палитры) с `opacity: 0.4` → едва заметная

### Взаимодействия

**Loading Popup**:
- **Клик вне popup**: не закрывает (блокирует UI)
- **Haptic Feedback**: `notificationOccurred('warning')` при показе popup

**Табы**:
- **Клик на таб**: переключает активный класс + haptic `selectionChanged()`
- **Визуальная анимация**: transition 200ms для плавного появления рамки

---

## Зависимости

### Внешние системы
- **Make.com**: webhook `book_slot` (уже существует)

### Внутренние зависимости

**Файлы**:
- `app.js`:
  - Функция `confirmBooking()` - добавить показ/скрытие loading popup
  - Функция `switchTab()` - уже работает, изменений не требуется
- `index.html`:
  - CSS стили для `.loading-overlay`, `.loading-card`
  - CSS изменение для `.bottom-nav button.active`

**Компоненты**:
- `showSuccessPopup()` - уже существует, использовать аналогичный паттерн
- `.spinner` - уже существует в app.js, переиспользовать

---

## Метрики успеха

### Как измерим успех фичи?

**Количественные метрики**:

**Loading Popup**:
- Время появления popup: < 50ms после клика
- Предотвращено двойное создание бронирования: 100% (нет дублей в Make.com History)

**Рамка табов**:
- Визуальная читаемость: активный таб заметен на beige фоне

**Качественные метрики**:
- Пользователь понимает что запрос обрабатывается
- Пользователь всегда знает на какой вкладке находится

---

## Риски и ограничения

### Технические риски

**Риск 1: Loading popup не закрывается при ошибке**
- **Вероятность**: Средняя
- **Влияние**: Высокое (UI заблокирован навсегда)
- **Митигация**: Добавить `finally { hideLoadingPopup() }` в `confirmBooking()`

**Риск 2: Рамка таба не видна на светлом фоне**
- **Вероятность**: Низкая
- **Влияние**: Среднее (UX ухудшится)
- **Митигация**: Тестировать на реальном устройстве, подобрать оптимальную прозрачность

### Ограничения

- Make.com таймаут: 10 секунд (hardcoded в `config.js`)
- Нет возможности отменить запрос после отправки в Make.com

---

## Открытые вопросы

_Все вопросы закрыты ✅_

## Решения и уточнения

### Решение по вопросу 1: Анимация loading popup
**2026-02-15**: Использовать существующий паттерн из "Создание платежа..." (плавная анимация fade-in/fade-out). Только текст изменить на "Создание встречи..."

### Решение по вопросу 2: Loading popup для оплаты клуба
**2026-02-15**: Для клуба уже реализовано "Создание платежа..." и работает корректно. Изменений не требуется.

---

## История изменений

**2026-02-15**
Версия: 1.0 (DRAFT)
Изменения: Создан первый драфт PRD на основе скринов IMG_6081.PNG, IMG_6082.PNG и логов

---

## Чек-лист готовности PRD

Перед переходом к этапу планирования убедись:

- [x] Понятна проблема и цель фичи
- [x] Описаны все must-have требования
- [x] Расписан happy path и основные edge cases
- [x] Определены метрики успеха
- [x] Выявлены риски и зависимости
- [x] Все блокирующие вопросы закрыты ✅
- [x] Статус изменён на `PRD_READY` ✅

**Только после этого можно переходить к созданию плана!**
