# CLAUDE.md — Инструкция для Claude Code

## Главное правило

**Всегда** сначала читай и соблюдай `conventions.md` перед любыми изменениями кода.

## Перед началом работы

### 1. Активный тикет

Проверь `docs/.active_ticket` (формат: `T-XXX`). 

### 2. Изучи контекст тикета

- **`docs/prd/T-XXX.prd.md`** - ЧТО делаем и ЗАЧЕМ 
- **`docs/plan/T-XXX.md`** - КАК делаем 
- **`docs/tasklist/T-XXX.md`** - СПИСОК задач с чекбоксами

### 3. Коротко, сформулируй план изменений

1. Опиши какие файлы будешь менять
2. Какие конкретно изменения внесёшь
3. Какие edge cases учтёшь
4. Как протестируешь изменения
5. **Дождись моего явного "ОК"

## Работа с кодом

### Общие принципы
- Минимальные изменения, без лишних рефакторингов
- Не рефактори 'заодно', без явного запроса
- Не меняй то, что и так работает

### Комментарии и документация

JSDoc для функций

/**
 * Создаёт бронирование в Make.com
 * @param {string} serviceId ID услуги из CONFIG.SERVICES
 * @param {Date} date Дата бронирования
 * @param {string} time Время "HH:MM"
 * @returns {Promise<Object|null>} Результат или null при ошибке
 */
async function createBooking(serviceId, date, time) {
  // ...
}

// Отменяем предыдущий запрос (race condition)
if (currentRequest) currentRequest.abort();

// Новый AbortController для текущего запроса
currentRequest = new AbortController();

#### HapticFeedback (тактильный отклик)

```javascript
// При успехе
tg.HapticFeedback.notificationOccurred('success');

// При ошибке  
tg.HapticFeedback.notificationOccurred('error');

// При предупреждении
tg.HapticFeedback.notificationOccurred('warning');

// При выборе элемента
tg.HapticFeedback.selectionChanged();

// Лёгкая вибрация
tg.HapticFeedback.impactOccurred('light');

### Работа с Make.com Backend

**Важно**: у тебя **НЕТ прямого доступа** к Make.com!

Что ты можешь:

- Предлагать изменения в структуре запросов
- Предложить свои варианты (коротко)

Что ты НЕ можешь:

- Напрямую менять сценарии Make.com
- Тестировать Make.com напрямую

## После внесения изменений

### 1. Покажи diff

Кратко опиши что изменилось в каждом файле, пример:
 
Изменения:

app.js: +25 -5
- Добавлена функция validateBookingData()
- Интегрирована валидация в createBooking()
- Добавлена обработка ошибок валидации

### 2. Предложи текст коммита

- Формат: `[TICKET-ID] Краткое описание`

### 3. Обнови tasklist

- Поставь `[x]` напротив выполненной задачи
- Допиши новые задачи при необходимости

## 4. Остановись и жди

- После изменений, уточни продолжать ли дальше 

##  Работа с ошибками

### Когда код не работает

**НЕ паникуй и НЕ переписывай всё заново!**

Алгоритм действий:

1. **Проанализируй ошибку**:
   
2. **Найди минимальный фикс**:
  
3. **Объясни причину**:

### Когда не уверен в решении

**Будь честен!** Скажи об этом и предложи варианты:

Например:

- Вариант 1: Валидация на фронтенде
- Плюсы: быстрая обратная связь, меньше нагрузки на Make
- Минусы: можно обойти через DevTools

# Запрещённые действия

 **НИКОГДА НЕ делай без разрешения**:

**НЕ коммить** изменения автоматически
**НЕ удалять** код без явного указания  
**НЕ менять** цветовую палитру и стили оставь как есть сейчас, пока явно не укажу что надо менять 
**НЕ добавлять** новые зависимости (библиотеки) предложить с обоснованием 
**НЕ рефакторить** код "заодно"
**НЕ переходить** к следующей задаче без команды

## Разрешённые и приветствуемые действия

**Можешь и должен**:

1. **Указывать на проблемы**
   - "Заметил, что функция X может упасть при Y"
   - "Этот код может вызвать утечку памяти"
   - "Здесь нарушается принцип из conventions.md" 
   - "Здесь в инструкции claude.md есть правило мешающее разработке 

2. **Предлагать улучшения**
  
3. **Дополнять документацию**
   - Обновлять комментарии
   - Заполнять документацию
   - Улучшать README # создать при необходимости 

4. **Улучшать обработку ошибок**
   - Добавлять try/catch где нужно
   - Делать понятные сообщения для пользователя
   - Логировать технические детали

5. **Оптимизировать производительность**
   - Предлагать кеширование
   - Уменьшать количество API вызовов
   - Оптимизировать рендеринг

### Тесты

**Всё тестируем на телефоне!**

**Инструменты**:

- Eruda DevTools (подключён в index.html)
- Проверяй основные сценарии и edge cases

## Документация

- Всегда обновляй `docs/tasklist/T-XXX.md, если появляются обновления
- Комментарии — только там, где без них непонятно «почему»

##  Что читать при работе

**Всегда**:
1. `conventions.md` - общие правила
2. `docs/prd/T-XXX.prd.md` - что делаем
3. `docs/tasklist/T-XXX.md` - список задач

**При необходимости**:
- `docs/plan/T-XXX.md` - архитектура решения
- `docs/prd/T-XXX.prd.md` - что делаем
- `docs/tasklist/T-XXX.md` - список задач
- `README.md` - общая информация о проекте


## Итог
Цель — аккуратно и предсказуемо решить задачу тикета, сохранив стиль, архитектуру и договорённости проекта.

